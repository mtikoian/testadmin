USE NETIKIP;
GO
/* ----------------------------------------------------------------------------------------------------
 
 File Name				:Update_Dup_Position_dg
 Business Description   :
 Created By				:VBANDI
 Created Date			: 09/22/2014
 ------------------------------------------------------------------------------------------------------
 */ 
SET XACT_ABORT ON;

PRINT '-------------Script Started at    :' + CONVERT(CHAR(23), GETDATE(), 121) + '------------------------';
PRINT SPACE(100);

DECLARE @Error INTEGER;
DECLARE @Rowcount BIGINT;
DECLARE @TOTALROWS INT;
DECLARE @Updatebatchsize INT;

SET @Updatebatchsize = 20000;
SET @Rowcount = 0;
SET @TOTALROWS = 0;

--check if temp table exists         
IF OBJECT_ID('tempdb..#tempPosition_dg') IS NOT NULL
	DROP TABLE #tempPosition_dg;

--check if temp table exists         
IF OBJECT_ID('tempdb..#tbPosition_dg') IS NOT NULL
	DROP TABLE #tbPosition_dg

CREATE TABLE #tempPosition_dg (
	Id INT identity(1, 1) NOT NULL PRIMARY KEY nonCLUSTERED
	,new_instr_id CHAR(16) NOT NULL
	,old_instr_id VARCHAR(16) NOT NULL
	);
	CREATE CLUSTERED INDEX nix_1 ON #tempPosition_dg
(
       new_instr_id,
       old_instr_id
)

CREATE TABLE #tbPosition_dg (
	RCD_NUM INT NOT NULL PRIMARY KEY
	,old_instr_id CHAR(16) NOT NULL
	);

INSERT INTO #tempPosition_dg
(new_instr_id,old_instr_id)
SELECT 'MD_1027'    ,'MD_724954'  UNION ALL
SELECT 'MD_1063'    ,'MD_724998'  UNION ALL
SELECT 'MD_1110'    ,'MD_710846'  UNION ALL
SELECT 'MD_1219'    ,'MD_712239'  UNION ALL
SELECT 'MD_1220'    ,'MD_711152'  UNION ALL
SELECT 'MD_1462'    ,'MD_713233'  UNION ALL
SELECT 'MD_232141'  ,'MD_479642'  UNION ALL
SELECT 'MD_232243'  ,'MD_762875'  UNION ALL
SELECT 'MD_232433'  ,'MD_590040'  UNION ALL
SELECT 'MD_235926'  ,'MD_496006'  UNION ALL
SELECT 'MD_236313'  ,'MD_716931'  UNION ALL
SELECT 'MD_236723'  ,'MD_333584'  UNION ALL
SELECT 'MD_238153'  ,'MD_739513'  UNION ALL
SELECT 'MD_239621'  ,'MD_720359'  UNION ALL
SELECT 'MD_239941'  ,'MD_336322'  UNION ALL
SELECT 'MD_241315'  ,'MD_707478'  UNION ALL
SELECT 'MD_243421'  ,'MD_427300'  UNION ALL
SELECT 'MD_245470'  ,'MD_513671'  UNION ALL
SELECT 'MD_245476'  ,'MD_700466'  UNION ALL
SELECT 'MD_250820'  ,'MD_573530'  UNION ALL
SELECT 'MD_250839'  ,'MD_472391'  UNION ALL
SELECT 'MD_254365'  ,'MD_337350'  UNION ALL
SELECT 'MD_254498'  ,'MD_419907'  UNION ALL
SELECT 'MD_254569'  ,'MD_346310'  UNION ALL
SELECT 'MD_255390'  ,'MD_315285'  UNION ALL
SELECT 'MD_255724'  ,'MD_479144'  UNION ALL
SELECT 'MD_255755'  ,'MD_353502'  UNION ALL
SELECT 'MD_256078'  ,'MD_641731'  UNION ALL
SELECT 'MD_257637'  ,'MD_352003'  UNION ALL
SELECT 'MD_258135'  ,'MD_262607'  UNION ALL
SELECT 'MD_260794'  ,'MD_707422'  UNION ALL
SELECT 'MD_262178'  ,'MD_329926'  UNION ALL
SELECT 'MD_263022'  ,'MD_545178'  UNION ALL
SELECT 'MD_263232'  ,'MD_756639'  UNION ALL
SELECT 'MD_264566'  ,'MD_547246'  UNION ALL
SELECT 'MD_265160'  ,'MD_341314'  UNION ALL
SELECT 'MD_267061'  ,'MD_583429'  UNION ALL
SELECT 'MD_267062'  ,'MD_583428'  UNION ALL
SELECT 'MD_277307'  ,'MD_585473'  UNION ALL
SELECT 'MD_279272'  ,'MD_681322'  UNION ALL
SELECT 'MD_284384'  ,'MD_640367'  UNION ALL
SELECT 'MD_290570'  ,'MD_345434'  UNION ALL
SELECT 'MD_297891'  ,'MD_734752'  UNION ALL
SELECT 'MD_297954'  ,'MD_72'	  UNION ALL
SELECT 'MD_301239'  ,'MD_730448'  UNION ALL
SELECT 'MD_301302'  ,'MD_749415'  UNION ALL
SELECT 'MD_304587'  ,'MD_725370'  UNION ALL
SELECT 'MD_304650'  ,'MD_739735'  UNION ALL
SELECT 'MD_304741'  ,'MD_743646'  UNION ALL
SELECT 'MD_307935'  ,'MD_731438'  UNION ALL
SELECT 'MD_307998'  ,'MD_740628'  UNION ALL
SELECT 'MD_311346'  ,'MD_743211'  UNION ALL
SELECT 'MD_314631'  ,'MD_726237'  UNION ALL
SELECT 'MD_314694'  ,'MD_741750'  UNION ALL
SELECT 'MD_324846'  ,'MD_642897'  UNION ALL
SELECT 'MD_327345'  ,'MD_740843'  UNION ALL
SELECT 'MD_336396'  ,'MD_365218'  UNION ALL
SELECT 'MD_336621'  ,'MD_336743'  UNION ALL
SELECT 'MD_341365'  ,'MD_515745'  UNION ALL
SELECT 'MD_346346'  ,'MD_423732'  UNION ALL
SELECT 'MD_346347'  ,'MD_423733'  UNION ALL
SELECT 'MD_346348'  ,'MD_419908'  UNION ALL
SELECT 'MD_346351'  ,'MD_419909'  UNION ALL
SELECT 'MD_346352'  ,'MD_424057'  UNION ALL
SELECT 'MD_346355'  ,'MD_424058'  UNION ALL
SELECT 'MD_346359'  ,'MD_424059'  UNION ALL
SELECT 'MD_346360'  ,'MD_424060'  UNION ALL
SELECT 'MD_346367'  ,'MD_424061'  UNION ALL
SELECT 'MD_346379'  ,'MD_424062'  UNION ALL
SELECT 'MD_352782'  ,'MD_430649'  UNION ALL
SELECT 'MD_353012'  ,'MD_437368'  UNION ALL
SELECT 'MD_353397'  ,'MD_353847'  UNION ALL
SELECT 'MD_354129'  ,'MD_506985'  UNION ALL
SELECT 'MD_354316'  ,'MD_385432'  UNION ALL
SELECT 'MD_354561'  ,'MD_609097'  UNION ALL
SELECT 'MD_354580'  ,'MD_608942'  UNION ALL
SELECT 'MD_354809'  ,'MD_651266'  UNION ALL
SELECT 'MD_354811'  ,'MD_380267'  UNION ALL
SELECT 'MD_360826'  ,'MD_362690'  UNION ALL
SELECT 'MD_361850'  ,'MD_466946'  UNION ALL
SELECT 'MD_363159'  ,'MD_363297'  UNION ALL
SELECT 'MD_365009'  ,'MD_709710'  UNION ALL
SELECT 'MD_366548'  ,'MD_366577'  UNION ALL
SELECT 'MD_367254'  ,'MD_407439'  UNION ALL
SELECT 'MD_369283'  ,'MD_713432'  UNION ALL
SELECT 'MD_375955'  ,'MD_465965'  UNION ALL
SELECT 'MD_381360'  ,'MD_410856'  UNION ALL
SELECT 'MD_382352'  ,'MD_382498'  UNION ALL
SELECT 'MD_405262'  ,'MD_411951'  UNION ALL
SELECT 'MD_422397'  ,'MD_453182'  UNION ALL
SELECT 'MD_423152'  ,'MD_713431'  UNION ALL
SELECT 'MD_424194'  ,'MD_427134'  UNION ALL
SELECT 'MD_431209'  ,'MD_542159'  UNION ALL
SELECT 'MD_435488'  ,'MD_435758'  UNION ALL
SELECT 'MD_436364'  ,'MD_448066'  UNION ALL
SELECT 'MD_437636'  ,'MD_543575'  UNION ALL
SELECT 'MD_437695'  ,'MD_674206'  UNION ALL
SELECT 'MD_442081'  ,'MD_763844'  UNION ALL
SELECT 'MD_446104'  ,'MD_502015'  UNION ALL
SELECT 'MD_446617'  ,'MD_455554'  UNION ALL
SELECT 'MD_446880'  ,'MD_513673'  UNION ALL
SELECT 'MD_448096'  ,'MD_455553'  UNION ALL
SELECT 'MD_464694'  ,'MD_473521'  UNION ALL
SELECT 'MD_476727'  ,'MD_478082'  UNION ALL
SELECT 'MD_498703'  ,'MD_757186'  UNION ALL
SELECT 'MD_498780'  ,'MD_736626'  UNION ALL
SELECT 'MD_499678'  ,'MD_654366'  UNION ALL
SELECT 'MD_501015'  ,'MD_501027'  UNION ALL
SELECT 'MD_501016'  ,'MD_501028'  UNION ALL
SELECT 'MD_503686'  ,'MD_756348'  UNION ALL
SELECT 'MD_510592'  ,'MD_550625'  UNION ALL
SELECT 'MD_531955'  ,'MD_549772'  UNION ALL
SELECT 'MD_533666'  ,'MD_674902'  UNION ALL
SELECT 'MD_534462'  ,'MD_662582'  UNION ALL
SELECT 'MD_536050'  ,'MD_536280'  UNION ALL
SELECT 'MD_548669'  ,'MD_569288'  UNION ALL
SELECT 'MD_563538'  ,'MD_571659'  UNION ALL
SELECT 'MD_567613'  ,'MD_567630'  UNION ALL
SELECT 'MD_567655'  ,'MD_567920'  UNION ALL
SELECT 'MD_573444'  ,'MD_583048'  UNION ALL
SELECT 'MD_573689'  ,'MD_603571'  UNION ALL
SELECT 'MD_578234'  ,'MD_583049'  UNION ALL
SELECT 'MD_578764'  ,'MD_583050'  UNION ALL
SELECT 'MD_583156'  ,'MD_585476'  UNION ALL
SELECT 'MD_588785'  ,'MD_674934'  UNION ALL
SELECT 'MD_590505'  ,'MD_763845'  UNION ALL
SELECT 'MD_591551'  ,'MD_763971'  UNION ALL
SELECT 'MD_591552'  ,'MD_763846'  UNION ALL
SELECT 'MD_592714'  ,'MD_674942'  UNION ALL
SELECT 'MD_594112'  ,'MD_674946'  UNION ALL
SELECT 'MD_594599'  ,'MD_674948'  UNION ALL
SELECT 'MD_599393'  ,'MD_763847'  UNION ALL
SELECT 'MD_601785'  ,'MD_674960'  UNION ALL
SELECT 'MD_602635'  ,'MD_674961'  UNION ALL
SELECT 'MD_608301'  ,'MD_674973'  UNION ALL
SELECT 'MD_613474'  ,'MD_640215'  UNION ALL
SELECT 'MD_614983'  ,'MD_725029'  UNION ALL
SELECT 'MD_623811'  ,'MD_624941'  UNION ALL
SELECT 'MD_625314'  ,'MD_675002'  UNION ALL
SELECT 'MD_625316'  ,'MD_675004'  UNION ALL
SELECT 'MD_627114'  ,'MD_627309'  UNION ALL
SELECT 'MD_631114'  ,'MD_675016'  UNION ALL
SELECT 'MD_631223'  ,'MD_633472'  UNION ALL
SELECT 'MD_631404'  ,'MD_654039'  UNION ALL
SELECT 'MD_631543'  ,'MD_675020'  UNION ALL
SELECT 'MD_631545'  ,'MD_675022'  UNION ALL
SELECT 'MD_632860'  ,'MD_763848'  UNION ALL
SELECT 'MD_633150'  ,'MD_633779'  UNION ALL
SELECT 'MD_635264'  ,'MD_635400'  UNION ALL
SELECT 'MD_637396'  ,'MD_675035'  UNION ALL
SELECT 'MD_642181'  ,'MD_675050'  UNION ALL
SELECT 'MD_642518'  ,'MD_675051'  UNION ALL
SELECT 'MD_642633'  ,'MD_643300'  UNION ALL
SELECT 'MD_642723'  ,'MD_645395'  UNION ALL
SELECT 'MD_643213'  ,'MD_675054'  UNION ALL
SELECT 'MD_644802'  ,'MD_645632'  UNION ALL
SELECT 'MD_646387'  ,'MD_763849'  UNION ALL
SELECT 'MD_646821'  ,'MD_647001'  UNION ALL
SELECT 'MD_648440'  ,'MD_678179'  UNION ALL
SELECT 'MD_648841'  ,'MD_657984'  UNION ALL
SELECT 'MD_648842'  ,'MD_675067'  UNION ALL
SELECT 'MD_650255'  ,'MD_650776'  UNION ALL
SELECT 'MD_653158'  ,'MD_653163'  UNION ALL
SELECT 'MD_653159'  ,'MD_653162'  UNION ALL
SELECT 'MD_653372'  ,'MD_675081'  UNION ALL
SELECT 'MD_654019'  ,'MD_657660'  UNION ALL
SELECT 'MD_660088'  ,'MD_675099'  UNION ALL
SELECT 'MD_666452'  ,'MD_666998'  UNION ALL
SELECT 'MD_669770'  ,'MD_763850'  UNION ALL
SELECT 'MD_677734'  ,'MD_749078'  UNION ALL
SELECT 'MD_678907'  ,'MD_698956'  UNION ALL
SELECT 'MD_679009'  ,'MD_679662'  UNION ALL
SELECT 'MD_681584'  ,'MD_681632'  UNION ALL
SELECT 'MD_682309'  ,'MD_689722'  UNION ALL
SELECT 'MD_684814'  ,'MD_762329'  UNION ALL
SELECT 'MD_692840'  ,'MD_693135'  UNION ALL
SELECT 'MD_692863'  ,'MD_763851'  UNION ALL
SELECT 'MD_694942'  ,'MD_695582'  UNION ALL
SELECT 'MD_696179'  ,'MD_753969'  UNION ALL
SELECT 'MD_696929'  ,'MD_706360'  UNION ALL
SELECT 'MD_701441'  ,'MD_391825'  UNION ALL
SELECT 'MD_702461'  ,'MD_326356'  UNION ALL
SELECT 'MD_702480'  ,'MD_708077'  UNION ALL
SELECT 'MD_704298'  ,'MD_704630'  UNION ALL
SELECT 'MD_704303'  ,'MD_704634'  UNION ALL
SELECT 'MD_710283'  ,'MD_733284'  UNION ALL
SELECT 'MD_715228'  ,'MD_717075'  UNION ALL
SELECT 'MD_715308'  ,'MD_717073'  UNION ALL
SELECT 'MD_715319'  ,'MD_717095'  UNION ALL
SELECT 'MD_715326'  ,'MD_717023'  UNION ALL
SELECT 'MD_715342'  ,'MD_717094'  UNION ALL
SELECT 'MD_716915'  ,'MD_715217'  UNION ALL
SELECT 'MD_717798'  ,'MD_717813'  UNION ALL
SELECT 'MD_726543'  ,'MD_728465'  UNION ALL
SELECT 'MD_727915'  ,'MD_727985'  UNION ALL
SELECT 'MD_727979'  ,'MD_728343'  UNION ALL
SELECT 'MD_727986'  ,'MD_728350'  UNION ALL
SELECT 'MD_728353'  ,'MD_727989'  UNION ALL
SELECT 'MD_731976'  ,'MD_756620'  UNION ALL
SELECT 'MD_732314'  ,'MD_732317'  UNION ALL
SELECT 'MD_732315'  ,'MD_732318'  UNION ALL
SELECT 'MD_733619'  ,'MD_733850'  UNION ALL
SELECT 'MD_735275'  ,'MD_736422'  UNION ALL
SELECT 'MD_735276'  ,'MD_736423'  UNION ALL
SELECT 'MD_740868'  ,'MD_742748'  UNION ALL
SELECT 'MD_740869'  ,'MD_742761'  UNION ALL
SELECT 'MD_741710'  ,'MD_741778'  UNION ALL
SELECT 'MD_742505'  ,'MD_742861'  UNION ALL
SELECT 'MD_743820'  ,'MD_743866'  UNION ALL
SELECT 'MD_743821'  ,'MD_743867'  UNION ALL
SELECT 'MD_745529'  ,'MD_746803'  UNION ALL
SELECT 'MD_745530'  ,'MD_746804'  UNION ALL
SELECT 'MD_748794'  ,'MD_753973'  UNION ALL
SELECT 'MD_749118'  ,'MD_749651'  UNION ALL
SELECT 'MD_749123'  ,'MD_749549'  UNION ALL
SELECT 'MD_749124'  ,'MD_749550'  UNION ALL
SELECT 'MD_749139'  ,'MD_749551'  UNION ALL
SELECT 'MD_749140'  ,'MD_749552'  UNION ALL
SELECT 'MD_749518'  ,'MD_749649'  UNION ALL
SELECT 'MD_750344'  ,'MD_752274'  UNION ALL
SELECT 'MD_751925'  ,'MD_758900'  UNION ALL
SELECT 'MD_751942'  ,'MD_754957'  UNION ALL
SELECT 'MD_752301'  ,'MD_753255'  UNION ALL
SELECT 'MD_752305'  ,'MD_753256'  UNION ALL
SELECT 'MD_752564'  ,'MD_753257'  UNION ALL
SELECT 'MD_752565'  ,'MD_753258'  UNION ALL
SELECT 'MD_752903'  ,'MD_752954'  UNION ALL
SELECT 'MD_752907'  ,'MD_752960'  UNION ALL
SELECT 'MD_752908'  ,'MD_752959'  UNION ALL
SELECT 'MD_752976'  ,'MD_753333'  UNION ALL
SELECT 'MD_753849'  ,'MD_753970'  UNION ALL
SELECT 'MD_753850'  ,'MD_753971'  UNION ALL
SELECT 'MD_753851'  ,'MD_753972'  UNION ALL
SELECT 'MD_755809'  ,'MD_755855'  UNION ALL
SELECT 'MD_755810'  ,'MD_755856'  UNION ALL
SELECT 'MD_755811'  ,'MD_755857'  UNION ALL
SELECT 'MD_760039'  ,'MD_764694'  UNION ALL
SELECT 'MD_760973'  ,'MD_761574'  UNION ALL
SELECT 'MD_760974'  ,'MD_761573'  UNION ALL
SELECT 'MD_761263'  ,'MD_764695'  UNION ALL
SELECT 'MD_778348'  ,'MD_778359'  UNION ALL
SELECT 'MD_778360'  ,'MD_778371'  UNION ALL
SELECT 'MD_778372'  ,'MD_778383'  UNION ALL
SELECT 'MD_778384'  ,'MD_778395'   ;




--SELECT *
--FROM #tempPosition_dg

--SELECT *
--FROM #tbPosition_dg

--SELECT rcd_num
--	,tb.old_instr_id
--	,tmp.new_instr_id
--FROM #tempPosition_dg tmp
--INNER JOIN #tbPosition_dg tb ON tmp.old_instr_id = tb.old_instr_id
BEGIN TRY
	WHILE 1 = 1
	BEGIN
		BEGIN TRANSACTION;
		INSERT INTO #tbPosition_dg
		(rcd_num, old_instr_id)
select top  (@Updatebatchsize) rcd_num , instr_id from
dbo.position_dg where instr_id in
('MD_724954'  
,'MD_724998'  
,'MD_710846'  
,'MD_712239'  
,'MD_711152'  
,'MD_713233'  
,'MD_479642'  
,'MD_762875'  
,'MD_590040'  
,'MD_496006'  
,'MD_716931'  
,'MD_333584'  
,'MD_739513'  
,'MD_720359'  
,'MD_336322'  
,'MD_707478'  
,'MD_427300'  
,'MD_513671'  
,'MD_700466'  
,'MD_573530'  
,'MD_472391'  
,'MD_337350'  
,'MD_419907'  
,'MD_346310'  
,'MD_315285'  
,'MD_479144'  
,'MD_353502'  
,'MD_641731'  
,'MD_352003'  
,'MD_262607'  
,'MD_707422'  
,'MD_329926'  
,'MD_545178'  
,'MD_756639'  
,'MD_547246'  
,'MD_341314'  
,'MD_583429'  
,'MD_583428'  
,'MD_585473'  
,'MD_681322'  
,'MD_640367'  
,'MD_345434'  
,'MD_734752'  
,'MD_72'	  
,'MD_730448'  
,'MD_749415'  
,'MD_725370'  
,'MD_739735'  
,'MD_743646'  
,'MD_731438'  
,'MD_740628'  
,'MD_743211'  
,'MD_726237'  
,'MD_741750'  
,'MD_642897'  
,'MD_740843'  
,'MD_365218'  
,'MD_336743'  
,'MD_515745'  
,'MD_423732'  
,'MD_423733'  
,'MD_419908'  
,'MD_419909'  
,'MD_424057'  
,'MD_424058'  
,'MD_424059'  
,'MD_424060'  
,'MD_424061'  
,'MD_424062'  
,'MD_430649'  
,'MD_437368'  
,'MD_353847'  
,'MD_506985'  
,'MD_385432'  
,'MD_609097'  
,'MD_608942'  
,'MD_651266'  
,'MD_380267'  
,'MD_362690'  
,'MD_466946'  
,'MD_363297'  
,'MD_709710'  
,'MD_366577'  
,'MD_407439'  
,'MD_713432'  
,'MD_465965'  
,'MD_410856'  
,'MD_382498'  
,'MD_411951'  
,'MD_453182'  
,'MD_713431'  
,'MD_427134'  
,'MD_542159'  
,'MD_435758'  
,'MD_448066'  
,'MD_543575'  
,'MD_674206'  
,'MD_763844'  
,'MD_502015'  
,'MD_455554'  
,'MD_513673'  
,'MD_455553'  
,'MD_473521'  
,'MD_478082'  
,'MD_757186'  
,'MD_736626'  
,'MD_654366'  
,'MD_501027'  
,'MD_501028'  
,'MD_756348'  
,'MD_550625'  
,'MD_549772'  
,'MD_674902'  
,'MD_662582'  
,'MD_536280'  
,'MD_569288'  
,'MD_571659'  
,'MD_567630'  
,'MD_567920'  
,'MD_583048'  
,'MD_603571'  
,'MD_583049'  
,'MD_583050'  
,'MD_585476'  
,'MD_674934'  
,'MD_763845'  
,'MD_763971'  
,'MD_763846'  
,'MD_674942'  
,'MD_674946'  
,'MD_674948'  
,'MD_763847'  
,'MD_674960'  
,'MD_674961'  
,'MD_674973'  
,'MD_640215'  
,'MD_725029'  
,'MD_624941'  
,'MD_675002'  
,'MD_675004'  
,'MD_627309'  
,'MD_675016'  
,'MD_633472'  
,'MD_654039'  
,'MD_675020'  
,'MD_675022'  
,'MD_763848'  
,'MD_633779'  
,'MD_635400'  
,'MD_675035'  
,'MD_675050'  
,'MD_675051'  
,'MD_643300'  
,'MD_645395'  
,'MD_675054'  
,'MD_645632'  
,'MD_763849'  
,'MD_647001'  
,'MD_678179'  
,'MD_657984'  
,'MD_675067'  
,'MD_650776'  
,'MD_653163'  
,'MD_653162'  
,'MD_675081'  
,'MD_657660'  
,'MD_675099'  
,'MD_666998'  
,'MD_763850'  
,'MD_749078'  
,'MD_698956'  
,'MD_679662'  
,'MD_681632'  
,'MD_689722'  
,'MD_762329'  
,'MD_693135'  
,'MD_763851'  
,'MD_695582'  
,'MD_753969'  
,'MD_706360'  
,'MD_391825'  
,'MD_326356'  
,'MD_708077'  
,'MD_704630'  
,'MD_704634'  
,'MD_733284'  
,'MD_717075'  
,'MD_717073'  
,'MD_717095'  
,'MD_717023'  
,'MD_717094'  
,'MD_715217'  
,'MD_717813'  
,'MD_728465'  
,'MD_727985'  
,'MD_728343'  
,'MD_728350'  
,'MD_727989'  
,'MD_756620'  
,'MD_732317'  
,'MD_732318'  
,'MD_733850'  
,'MD_736422'  
,'MD_736423'  
,'MD_742748'  
,'MD_742761'  
,'MD_741778'  
,'MD_742861'  
,'MD_743866'  
,'MD_743867'  
,'MD_746803'  
,'MD_746804'  
,'MD_753973'  
,'MD_749651'  
,'MD_749549'  
,'MD_749550'  
,'MD_749551'  
,'MD_749552'  
,'MD_749649'  
,'MD_752274'  
,'MD_758900'  
,'MD_754957'  
,'MD_753255'  
,'MD_753256'  
,'MD_753257'  
,'MD_753258'  
,'MD_752954'  
,'MD_752960'  
,'MD_752959'  
,'MD_753333'  
,'MD_753970'  
,'MD_753971'  
,'MD_753972'  
,'MD_755855'  
,'MD_755856'  
,'MD_755857'  
,'MD_764694'  
,'MD_761574'  
,'MD_761573'  
,'MD_764695'  
,'MD_778359'  
,'MD_778371'  
,'MD_778383'  
,'MD_778395' ) ;


		UPDATE TOP (@Updatebatchsize) pg
		SET pg.instr_id = tbl.new_instr_id
		--select instr_id,   tbl.new_instr_id
		FROM dbo.Position_dg pg
		INNER JOIN (
			SELECT rcd_num
				,tb.old_instr_id
				,tmp.new_instr_id
			FROM #tempPosition_dg tmp
			INNER JOIN #tbPosition_dg tb ON tmp.old_instr_id = tb.old_instr_id
			) tbl ON tbl.RCD_NUM = pg.rcd_num
			and tbl.old_instr_id = pg.instr_id;

		SET @RowCount = @@rowcount;
		SET @TOTALROWS = @TOTALROWS + @RowCount;
		

		
		IF @RowCount = 0 -- terminating condition;
		BEGIN
			COMMIT TRANSACTION;

			BREAK;
		END;

		COMMIT TRANSACTION;

		-- WAITFOR DELAY '00:00:01';
		PRINT 'Total records Updated as of now ' + CAST(@TOTALROWS AS VARCHAR) + ' total rows';
		Truncate table #tbPosition_dg
		--select count(1) from #tbPosition_dg
	END;
END TRY

BEGIN CATCH
	IF XACT_STATE() <> 0
		OR @@TRANCOUNT > 0
	BEGIN
		ROLLBACK TRANSACTION;
	END;

	DECLARE @error_Message VARCHAR(4000);
	DECLARE @error_Severity INT;
	DECLARE @error_State INT;

	SET @error_Message = 'Error encoutered while updating records for tables dbo.Position_dg ' + ERROR_MESSAGE();
	SET @error_Severity = ERROR_SEVERITY();
	SET @error_State = ERROR_STATE();

	RAISERROR (
			@error_Message
			,@error_Severity
			,@error_State
			);
END CATCH;

PRINT SPACE(100);
PRINT '-------------Script completed at :' + CONVERT(CHAR(23), GETDATE(), 121) + '------------------------';

